# 分布式锁

#### Redis实现分布式锁
加锁: SET key value NX PX time
其中key即为锁的名称，value为随机值，避免和别的锁重复，NX表示不存在才创建，存在则不创建，PX后跟具体过期时间(毫秒为单位)
释放锁通过lua脚本实现，根据value值判断当前锁是不是自己加的锁，如果是自己加的锁，则可以释放(即删除 key)

#### Zookeeper分布式锁
zk实现分布式锁，通过创建一个临时节点来实现。如果临时节点不存在，可以创建成功，否则则注册一个监听器监听该临时节点。
释放锁通过删除锁实现。

zk还可以使用临时顺序节点来更优雅地实现分布式锁。

为什么要使用临时节点?  
使用临时节点可以避免节点下线导致的锁不释放。假如创建临时节点的节点下线，其创建的临时节点也会自动释放。


#### Redis分布式锁和Zookeeper分布式锁对比
 | Redis分布式锁 | Zookeeper分布式锁
-|-|-
实现复杂度| 通过两条命令即可实现一个简单的分布式锁，较为简单 | 较为复杂 
锁的安全性| 如果存储锁的节点宕机锁丢失，可以通过RedLock算法改进，但仍不安全 | -
锁的性能| 如果获取不到锁，需要主动轮询，比较消耗性能 | 如果获取不到锁，可以加监听器，锁释放后会通知
锁的健壮性| 如果创建锁的节点节点宕机，需要等待锁超时释放 | 如果创建锁的节点宕机，锁自动释放
